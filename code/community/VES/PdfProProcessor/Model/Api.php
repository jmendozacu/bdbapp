<?php 
 /**
 * @author		VnEcoms Team <support@vnecoms.com>
 * @website		http://www.vnecoms.com
 */class VES_PdfProProcessor_Model_Api{    const PDF_PRO_WSDL = 'r0zxpJlqSHdBKEjlCP9Xng0w/dk2htuUHo0zldCFd4BNGEqzBMVq1Gv2DtTN+RLhZTJU6q8jXyhBhspOkYMw1A==';    const PDF_PRO_WSDL_DEV = '/BjMOeoCH8YfyHoPc6j5J+63/2ahVFdeg1v6UIY/1/xFk3sQe6OnDvhTHqetoKYOtwtT9KYsAwU360adBUekdw==';    const PDF_PRO_XMLRPC = 'r0zxpJlqSHdBKEjlCP9Xng0w/dk2htuUHo0zldCFd4BkqJyD87fw8QBTsUrwFThlX0xsYPD56yJVLB2n7gKvfw==';    const PDF_PRO_API_USERNAME = 'm6oKw/bnKJTI9A+PCkt8nMJMJgQbMxI/sGDQpRxwCbk=';    const PDF_PRO_API_PASSWORD = 'wSljQQuWzjU0K8xBeQ159Pb9B/h9P4qeVIZkM+TVz1Q=';    protected $_api_key;    protected function _decode($encoded, $key)    {        $code = trim(mcrypt_decrypt(MCRYPT_RIJNDAEL_256, md5($key), base64_decode($encoded), MCRYPT_MODE_CBC, md5(md5($key))), "\0");        return $code;    }    protected function _encode($code, $key)    {        $code = base64_encode(mcrypt_encrypt(MCRYPT_RIJNDAEL_256, md5($key), $code, MCRYPT_MODE_CBC, md5(md5($key))));        return $code;    }    protected function _compress($code)    {        return gzdeflate(gzcompress($code, 9), 9);    }    protected function _unCompress($code)    {        return gzuncompress(gzinflate($code));    }    public function __construct($apiKey = null)    {        $this->_api_key = $apiKey;        return $this;    }    public function loadInformationFromServer()    {        $url               = 'http://www.easypdfinvoice.com/pdf/process/sync';        $params            = array(            'username' => $this->_encode(Mage::getStoreConfig('pdfpro/pdfprocessor/email'), $this->_api_key),            'password' => $this->_encode(Mage::getStoreConfig('pdfpro/pdfprocessor/password'), $this->_api_key),            'version' => PdfPro::getVersion(),            'api_key' => $this->_api_key        );        $result            = $this->sendRequest($params, $url);        $result            = json_decode($result, true);        $result['content'] = $this->_decode($result['content'], $this->_api_key);        return $result;    }    public function updatePrintedTime($printedTime)    {        $url    = 'http://www.easypdfinvoice.com/pdf/process/updateprintjobs';        $params = array(            'username' => $this->_encode(Mage::getStoreConfig('pdfpro/pdfprocessor/email'), $this->_api_key),            'password' => $this->_encode(Mage::getStoreConfig('pdfpro/pdfprocessor/password'), $this->_api_key),            'version' => PdfPro::getVersion(),            'api_key' => $this->_api_key,            'print_jobs' => $printedTime        );        $result = $this->sendRequest($params, $url);        $result = json_decode($this->_decode($result, $this->_api_key), true);        return $result;    }    public function sendRequest($params, $url)    {        $fieldString = '';        foreach ($params as $key => $value) {            $fieldString .= urlencode($key) . '=' . urlencode($value) . "&";        }        $fieldString = trim($fieldString, '&');        $agent       = 'Mozilla/5.0 (Windows NT 6.2; WOW64; rv:19.0) Gecko/20100101 Firefox/19.0';        $ch          = curl_init();        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);        curl_setopt($ch, CURLOPT_VERBOSE, true);        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);        curl_setopt($ch, CURLOPT_USERAGENT, $agent);        curl_setopt($ch, CURLOPT_HEADER, 0);        curl_setopt($ch, CURLOPT_POSTFIELDS, $fieldString);        curl_setopt($ch, CURLOPT_URL, $url);        $result = curl_exec($ch);        return $result;    }}